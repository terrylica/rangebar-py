# =============================================================================
# rangebar-py mise configuration (Hub)
# =============================================================================
# This is the SSoT for environment variables and tools.
# Tasks are split into domain-specific files in .mise/tasks/
#
# Task files:
#   .mise/tasks/dev.toml      - fmt, lint, test, build
#   .mise/tasks/release.toml  - release workflow, platform builds
#   .mise/tasks/bench.toml    - benchmarking
#   .mise/tasks/prof.toml     - profiling
#   .mise/tasks/deps.toml     - dependency management
#   .mise/tasks/validate.toml - production validation
#   .mise/tasks/cache.toml    - ClickHouse cache
#   .mise/tasks/smoke.toml    - smoke tests
#   .mise/tasks/checksum.toml - checksum verification
#   .mise/tasks/diag.toml     - diagnostics
#   .mise/tasks/research.toml - research cache population

[env]
# =============================================================================
# SSoT: Minimum Thresholds by Asset Class (Issue #62)
# =============================================================================
# Values are in decimal basis points (dbps): 1000 dbps = 1%
RANGEBAR_CRYPTO_MIN_THRESHOLD = "250"
RANGEBAR_FOREX_MIN_THRESHOLD = "50"
RANGEBAR_EQUITIES_MIN_THRESHOLD = "100"
RANGEBAR_UNKNOWN_MIN_THRESHOLD = "1"

# =============================================================================
# SSoT: Per-Symbol Minimum Thresholds (Issue #89)
# =============================================================================
# Meme coins produce too many bars at low thresholds, making intra-bar
# feature computation infeasible. These env vars are the SOLE SSoT â€”
# threshold.py:get_min_threshold_for_symbol() reads them directly.
# Resolution: per-symbol env > asset-class env > fallback default.
RANGEBAR_MIN_THRESHOLD_SHIBUSDT = "500"
RANGEBAR_MIN_THRESHOLD_DOGEUSDT = "500"

# =============================================================================
# SSoT: Microstructure Feature Defaults (Issue #68)
# =============================================================================
# When include_microstructure=True, these defaults are used unless overridden.
# INTER_BAR_LOOKBACK_COUNT: Trades in lookback window for inter-bar features.
#   - Recommended: 100-500 (200 is good balance of signal vs compute)
#   - Set to 0 to disable inter-bar features while keeping intra-bar
# INCLUDE_INTRA_BAR_FEATURES: Enable ITH + statistical features within bars.
#   - "true" enables 22 intra_* columns (ITH, complexity, statistical)
#   - "false" disables (use if you only need lookback_* features)
RANGEBAR_INTER_BAR_LOOKBACK_COUNT = "200"
RANGEBAR_INCLUDE_INTRA_BAR_FEATURES = "true"

# =============================================================================
# GitHub Account Isolation
# =============================================================================
GH_ACCOUNT = "terrylica"
GH_CONFIG_DIR = "{{ env.HOME }}/.config/gh/profiles/terrylica"
GH_TOKEN = "{{ read_file(path=env.HOME ~ '/.claude/.secrets/gh-token-terrylica') | trim }}"
GITHUB_TOKEN = "{{ read_file(path=env.HOME ~ '/.claude/.secrets/gh-token-terrylica') | trim }}"

# =============================================================================
# 1Password Configuration
# =============================================================================
OP_PYPI_ITEM = "djevteztvbcqgcm3yl4njkawjq"

# =============================================================================
# ClickHouse Cache Configuration
# =============================================================================
RANGEBAR_CH_HOSTS = "bigblack"
RANGEBAR_CH_PRIMARY = "bigblack"

# =============================================================================
# Build Configuration
# =============================================================================
BENCH_DATA_DIR = "{{ env.PWD }}/bench-data"
PROFILE_DATA_DIR = "{{ env.PWD }}/profile-data"

# =============================================================================
# Linux Build Configuration
# =============================================================================
LINUX_BUILD_STRATEGY = "zig"  # "zig" or "remote"
LINUX_BUILD_HOST = "bigblack"
LINUX_BUILD_USER = "tca"
LINUX_BUILD_DIR = "/tmp/rangebar-py-build"
LINUX_MATURIN_PROFILE = "wheel"
LINUX_MATURIN_COMPAT = "manylinux_2_17"
LINUX_MIN_DISK_GB = "5"
LINUX_MIN_RUST_VERSION = "1.90"
BUILD_LOCK_DIR = "/tmp/rangebar-py-locks"

# =============================================================================
# Tools
# =============================================================================

[tools]
python = "3.13"
rust = "1.90"
node = "22"
uv = "latest"
zig = "0.13"
"cargo:cargo-nextest" = "latest"
"cargo:cargo-deny" = "latest"
"cargo:cargo-outdated" = "latest"
"cargo:flamegraph" = "0.6"
"cargo:maturin" = "latest"
"cargo:cargo-zigbuild" = "latest"

# =============================================================================
# Task Includes (Hub-and-Spoke)
# =============================================================================

[task_config]
includes = [
    ".mise/tasks/dev.toml",
    ".mise/tasks/release.toml",
    ".mise/tasks/bench.toml",
    ".mise/tasks/prof.toml",
    ".mise/tasks/deps.toml",
    ".mise/tasks/validate.toml",
    ".mise/tasks/cache.toml",
    ".mise/tasks/smoke.toml",
    ".mise/tasks/checksum.toml",
    ".mise/tasks/diag.toml",
    ".mise/tasks/research.toml",
    ".mise/tasks/telemetry.toml",
]
