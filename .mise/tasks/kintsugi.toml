# Issue #115: Kintsugi self-healing gap reconciliation

[kintsugi]
description = "Kintsugi: discover shards, repair with Ariadne+Ouroboros, verify"
run = "uv run --python 3.13 python scripts/kintsugi.py"

["kintsugi:check"]
description = "Kintsugi dry-run: discover and classify shards without repairing"
run = "uv run --python 3.13 python scripts/kintsugi.py --dry-run"

["kintsugi:daemon"]
description = "Start Kintsugi daemon (long-running self-healer)"
run = "uv run --python 3.13 python scripts/kintsugi.py --daemon"

["kintsugi:log"]
description = "Show recent Kintsugi repair activity from ClickHouse"
run = """
uv run --python 3.13 python -c "
from rangebar.clickhouse import RangeBarCache
with RangeBarCache() as c:
    rows = c.client.query('''
        SELECT timestamp, symbol, threshold_decimal_bps, priority, action, result,
               ariadne_from_id, ouroboros_splits, bars_written
        FROM rangebar_cache.kintsugi_log
        ORDER BY timestamp DESC LIMIT 20
    ''').result_rows
    for r in rows:
        ariadne = 'A' if r[6] > 0 else 'T'
        print(f'{r[0]} | {r[1]}@{r[2]} | {r[3]} | {r[4]} -> {r[5]} | {ariadne}:{r[6]} O:{r[7]} ({r[8]} bars)')
"
"""

["kintsugi:replay"]
description = "Replay dead-letter files from sidecar flush failures"
run = "uv run --python 3.13 python scripts/kintsugi.py --replay-dead-letters"
